<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>5</storyId>
    <title>Display Basic Visuals for Rooms</title>
    <status>drafted</status>
    <generatedAt>2025-12-04</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-5-display-basic-visuals-for-rooms.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>player</asA>
    <iWant>to see a background image for each room</iWant>
    <soThat>the game feels more immersive</soThat>
    <tasks>
- [ ] AC 1: Source and prepare image assets.
  - [ ] Subtask: Select a library of free-to-use images for each hard-coded room (e.g., Room 1, Room 2, Room 3).
  - [ ] Subtask: Store images in `ai-escape-app/static/images/`.
- [ ] AC 1: Create a mapping between rooms and image assets.
  - [ ] Subtask: Update the room data structure (e.g., in `data/rooms.py` from Story 1.3) to include a reference to the corresponding image file for each room.
- [ ] AC 1: Implement dynamic display of background images.
  - [ ] Subtask: Modify the Jinja2 templates (e.g., `templates/game.html`) to dynamically load and display the background image based on the `current_room` in the `GameSession`.
  - [ ] Subtask: Ensure images are responsive and accessible (e.g., using `alt=""` for decorative images).
- [ ] AC 1: Implement unit and integration tests.
  - [ ] Subtask: Write unit tests for the room-to-image mapping data structure.
  - [ ] Subtask: Write integration tests to verify that Flask routes correctly pass image data to templates.
  - [ ] Subtask: Write E2E tests to visually confirm that the correct background image is displayed for each room in the UI.
</tasks>
  </story>

  <acceptanceCriteria>
    <criterion>Given the player enters a new room, when the room description is displayed, then a corresponding background image for that room is also displayed.</criterion>
</acceptanceCriteria>

  <artifacts>
<docs>
    <doc>
        <path>docs/prd.md</path>
        <title>Product Requirements Document: AI Escape</title>
        <section>FR-010: Basic Visuals</section>
        <snippet>A pre-selected, free-to-use image library organized by theme to provide atmospheric background images for rooms.</snippet>
    </doc>
    <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Asset Management/Storage</section>
        <snippet>Start with local storage in `static/` directory. Easily migratable to CDN for scalability.</snippet>
    </doc>
    <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>UX/UI</section>
        <snippet>Accessibility Implementation (WCAG 2.1 Level AA compliant color contrast). Tailwind CSS for styling. Visual foundation with a defined color system and typography. Project Structure: `static/images/` for images.</snippet>
    </doc>
    <doc>
        <path>docs/epics.md</path>
        <title>ibe160 - Epic Breakdown</title>
        <section>Epic 1: Foundational Framework & A Single, Static Escape Room</section>
        <snippet>Epic 1 aims to build a robust technical foundation and a complete, testable, end-to-end user experience with a single, hard-coded story and puzzle chain.</snippet>
    </doc>
    <doc>
        <path>docs/epics.md</path>
        <title>ibe160 - Epic Breakdown</title>
        <section>Story 1.5: Display Basic Visuals for Rooms</section>
        <snippet>Story 1.5 focuses on displaying static background images for each room to enhance immersion, utilizing local storage for assets.</snippet>
    </doc>
    <doc>
        <path>docs/ux-design-specification.md</path>
        <title>AI Escape - UX Design Specification</title>
        <section>2. Visual Foundation</section>
        <snippet>The UX Design Specification outlines visual foundations (retro-futuristic colors, `Press Start 2P`, `Roboto Mono` fonts), responsive design strategy for mobile/tablet/desktop, and an accessibility strategy targeting WCAG 2.1 Level AA compliance.</snippet>
    </doc>
</docs>
    <code>
        <code-ref>
            <path>ai-escape-app/static/images/</path>
            <kind>directory</kind>
            <reason>Storage for new visual assets for rooms</reason>
        </code-ref>
        <code-ref>
            <path>ai-escape-app/data/rooms.py</path>
            <kind>file</kind>
            <reason>To update mapping between rooms and image assets</reason>
        </code-ref>
        <code-ref>
            <path>ai-escape-app/templates/game.html</path>
            <kind>file</kind>
            <reason>To dynamically load and display background images</reason>
        </code-ref>
        <code-ref>
            <path>ai-escape-app/tests/</path>
            <kind>directory</kind>
            <reason>For new unit and integration tests for visual display</reason>
        </code-ref>
    </code>
    <dependencies>
      <python>
        <package name="Flask" version="3.1.2" />
        <package name="python-dotenv" version="?" />
        <package name="gunicorn" version="?" />
        <package name="pytest" version="?" />
        <note>Core Python dependencies for the Flask application.</note>
      </python>
      <node>
        <package name="playwright" version="?" />
        <note>Existing Node.js project dependencies for E2E testing.</note>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
        <type>Required Pattern</type>
        <description>Python Flask application structure (modular, with `app.py`, `static/`, `templates/`, `models.py`, `routes.py`, `services/`, `tests/`).</description>
        <source>docs/architecture.md#Project-Structure</source>
    </constraint>
    <constraint>
        <type>Required Pattern</type>
        <description>WCAG 2.1 Level AA accessibility compliance.</description>
        <source>docs/architecture.md#Accessibility-Implementation</source>
    </constraint>
    <constraint>
        <type>Required Pattern</type>
        <description>Stateless JWT Authentication.</description>
        <source>docs/architecture.md#Security-Architecture</source>
    </constraint>
    <constraint>
        <type>Layer Restriction</type>
        <description>Frontend (Jinja2 templates/Static assets) &lt;-> Backend (Flask Routes/API Endpoints).</description>
        <source>docs/architecture.md#Integration-Points</source>
    </constraint>
    <constraint>
        <type>Layer Restriction</type>
        <description>Flask Routes/API Endpoints &lt;-> AI Service (Gemini API).</description>
        <source>docs/architecture.md#Integration-Points</source>
    </constraint>
    <constraint>
        <type>Layer Restriction</type>
        <description>Flask Routes/API Endpoints &lt;-> Database (Supabase PostgreSQL via SQLAlchemy).</description>
        <source>docs/architecture.md#Integration-Points</source>
    </constraint>
    <constraint>
        <type>Testing Requirement</type>
        <description>Unit Tests (Pytest with `pytest-mock`).</description>
        <source>docs/architecture.md#Comprehensive-Testing-Strategy</source>
    </constraint>
    <constraint>
        <type>Testing Requirement</type>
        <description>Integration Tests (Pytest).</description>
        <source>docs/architecture.md#Comprehensive-Testing-Strategy</source>
    </constraint>
    <constraint>
        <type>Testing Requirement</type>
        <description>E2E Tests (Playwright).</description>
        <source>docs/architecture.md#Comprehensive-Testing-Strategy</source>
    </constraint>
    <constraint>
        <type>Coding Standard</type>
        <description>Python Classes: `PascalCase`, Python Functions/Variables: `snake_case`, Python Modules/Files: `snake_case`, Database Tables: `snake_case` (plural), Database Columns: `snake_case`, API Endpoints: `kebab-case` for URL paths, `snake_case` for query parameters, Constants: `SCREAMING_SNAKE_CASE`.</description>
        <source>docs/architecture.md#Consistency-Rules</source>
    </constraint>
    <constraint>
        <type>Coding Standard</type>
        <description>Code Organization: Modular Flask application layout.</description>
        <source>docs/architecture.md#Code-Organization</source>
    </constraint>
</constraints>

<interfaces></interfaces>
  <tests>
    <standards>
      <standard>
        <framework>Pytest</framework>
        <type>Unit, Integration</type>
        <note>Use `pytest-mock` for unit testing isolation if needed.</note>
        <source>docs/architecture.md#Comprehensive-Testing-Strategy</source>
      </standard>
      <standard>
        <framework>Playwright</framework>
        <type>E2E</type>
        <source>docs/architecture.md#Comprehensive-Testing-Strategy</source>
      </standard>
    </standards>
    <locations>
      <location>tests/</location>
      <note>Mirroring the application's module structure (e.g., `tests/unit/`, `tests/integration/`).</note>
    </locations>
    <ideas>
      <idea ac="1">
        <description>Write unit tests for the room-to-image mapping data structure.</description>
      </idea>
      <idea ac="1">
        <description>Write integration tests to verify that Flask routes correctly pass image data to templates.</description>
      </idea>
      <idea ac="1">
        <description>Write E2E tests to visually confirm that the correct background image is displayed for each room in the UI.</description>
      </idea>
    </ideas>
  </tests>
</story-context>